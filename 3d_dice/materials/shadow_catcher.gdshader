shader_type spatial;

// ---------------------------------------------------------------------
// ‚öôÔ∏è UNIFORMS (editable in Inspector via the .tres material)
// ---------------------------------------------------------------------

// Shadow color ‚Äî black by default (vec3 = RGB, range 0‚Äì1)
uniform vec3 shadow_color : source_color = vec3(0.0, 0.0, 0.0);

// Shadow intensity ‚Äî how strongly darkness appears in shadowed zones
// 0.0 ‚Üí no visible shadow | 1.0 ‚Üí full darkness
uniform float shadow_opacity : hint_range(0.0, 1.0) = 0.6;

// Maximum darkness limit ‚Äî caps total shadow intensity
// 0.0 ‚Üí extremely faint | 1.0 ‚Üí can reach pure black
uniform float shadow_max_opacity : hint_range(0.0, 1.0) = 0.8;

// ---------------------------------------------------------------------
// üß© FRAGMENT ‚Äî base surface definition
// ---------------------------------------------------------------------
void fragment() {
	// Base color of the plane (kept blackish)
	ALBEDO = shadow_color;

	// Plane itself invisible; only light() will reveal shadows
	ALPHA = 0.0;
}

// ---------------------------------------------------------------------
// üí° LIGHT ‚Äî runs per light source, applies shadow transparency
// ---------------------------------------------------------------------
void light() {
	// ATTENUATION = 1.0 (lit) ‚Üí 0.0 (in shadow)
	// (1.0 - ATTENUATION) = how much of the pixel is shadowed
	float shadow_strength = shadow_opacity * (1.0 - ATTENUATION);

	// Clamp to prevent excessive opacity
	ALPHA = min(shadow_strength, shadow_max_opacity);
}